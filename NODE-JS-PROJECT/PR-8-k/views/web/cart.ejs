<%- include("./header") %>

<div class="container my-5">

    <!-- Page Header with Animation -->
    <h2 class="text-center fw-bold mb-5 position-relative cart-header">
        <i class="bi bi-cart3 me-2"></i>
        My Shopping Cart
        <span class="header-underline"></span>
    </h2>

    <% if(cart.length === 0) { %>

        <!-- Empty Cart State with Animation -->
        <div class="empty-cart-container text-center p-5 bg-white shadow-sm rounded-4">
            <div class="empty-cart-icon mb-4">
                <i class="bi bi-cart-x fs-1 text-muted"></i>
            </div>
            <h4 class="text-muted mb-3">Your cart is feeling lonely...</h4>
            <p class="text-secondary mb-4">Add some amazing products to get started!</p>
            <a href="/web" class="btn btn-primary btn-lg px-5 py-3 rounded-pill continue-shopping-btn">
                <i class="bi bi-arrow-left me-2"></i>
                Continue Shopping
                <i class="bi bi-emoji-smile ms-2"></i>
            </a>
            
            <!-- Suggested Products (example) -->
            <div class="suggested-products mt-5">
                <h5 class="text-muted mb-4">You might like these:</h5>
                <div class="row g-3 justify-content-center">
                    <div class="col-md-3 col-6">
                        <div class="suggested-item p-3 bg-light rounded-3">
                            <i class="bi bi-phone fs-2 d-block mb-2"></i>
                            <small>Electronics</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="suggested-item p-3 bg-light rounded-3">
                            <i class="bi bi-laptop fs-2 d-block mb-2"></i>
                            <small>Laptops</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="suggested-item p-3 bg-light rounded-3">
                            <i class="bi bi-watch fs-2 d-block mb-2"></i>
                            <small>Accessories</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <% } else { %>

        <% let grandTotal = 0; %>

        <!-- Cart Items Container -->
        <div class="cart-items-container">
            <% cart.forEach((item, index) => { %>
                <% grandTotal += item.price * item.qty; %>

                <div class="card mb-3 shadow-sm border-0 cart-item"
                     style="border-radius:15px; animation: slideIn 0.5s ease <%= index * 0.1 %>s both;">
                    
                    <div class="row align-items-center p-3 g-3">

                        <!-- Product Image -->
                        <div class="col-md-2 text-center">
                            <div class="cart-item-image-wrapper">
                                <img src="<%= item.productImage %>"
                                     class="img-fluid cart-item-image"
                                     style="max-height:80px; object-fit:contain;">
                            </div>
                        </div>

                        <!-- Product Details -->
                        <div class="col-md-4">
                            <h6 class="fw-bold mb-1 product-name">
                                <%= item.productName %>
                            </h6>
                            <div class="price-details">
                                <span class="text-muted small">Unit Price:</span>
                                <span class="fw-semibold text-primary ms-2">₹ <%= item.price %></span>
                            </div>
                            <p class="cart-item-total mb-0">
                                <span class="text-muted small">Total:</span>
                                <span class="text-success fw-bold ms-2">
                                    ₹ <%= item.price * item.qty %>
                                </span>
                            </p>
                        </div>

                        <!-- Quantity Controls -->
                        <div class="col-md-3">
                            <div class="quantity-controls d-flex align-items-center justify-content-center gap-2">
                                
                                <a href="/web/cart/decrement/<%= item.id %>"
                                   class="btn btn-outline-danger btn-sm rounded-circle quantity-btn decrement-btn"
                                   style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-dash-lg"></i>
                                </a>

                                <span class="fw-bold quantity-display">
                                    <%= item.qty %>
                                </span>

                                <a href="/web/cart/increment/<%= item.id %>"
                                   class="btn btn-outline-success btn-sm rounded-circle quantity-btn increment-btn"
                                   style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-plus-lg"></i>
                                </a>

                            </div>
                            
                            <!-- Stock Status (example) -->
                            <% if(item.qty > 5) { %>
                                <div class="text-center mt-2">
                                    <span class="badge bg-success bg-opacity-10 text-success small">
                                        <i class="bi bi-check-circle-fill me-1"></i>In Stock
                                    </span>
                                </div>
                            <% } %>
                        </div>

                        <!-- Remove Button -->
                        <div class="col-md-3 text-end">
                            <a href="/web/cart/delete/<%= item.id %>"
                               class="btn btn-outline-danger remove-btn">
                                <i class="bi bi-trash3 me-1"></i>
                                Remove
                            </a>
                        </div>

                    </div>
                    
                    <!-- Item Progress Bar (Optional) -->
                    <div class="item-progress" style="height: 3px; background: linear-gradient(90deg, #28a745 0%, #28a745 <%= (item.qty/10)*100 %>%);"></div>
                </div>
            <% }) %>
        </div>

        <!-- Cart Summary Section -->
        <div class="cart-summary mt-4">
            <div class="card shadow-lg border-0 summary-card"
                 style="border-radius:15px;">
                
                <div class="card-body p-4">
                    
                    <!-- Summary Header -->
                    <h5 class="fw-bold mb-4 summary-title">
                        <i class="bi bi-receipt me-2"></i>
                        Order Summary
                    </h5>
                    
                    <!-- Price Breakdown -->
                    <div class="price-breakdown mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Subtotal:</span>
                            <span class="fw-semibold">₹ <%= grandTotal %></span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Shipping:</span>
                            <span class="fw-semibold text-success">Free</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Tax (GST):</span>
                            <span class="fw-semibold">₹ <%= Math.round(grandTotal * 0.18) %></span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="fw-bold">Total Amount:</span>
                            <span class="text-success fw-bold fs-4 total-amount">
                                ₹ <%= grandTotal + Math.round(grandTotal * 0.18) %>
                            </span>
                        </div>
                        <small class="text-muted">Inclusive of all taxes</small>
                    </div>
                    
                    <!-- Delivery Estimate -->
                    <div class="delivery-estimate bg-light p-3 rounded-3 mb-4">
                        <div class="d-flex align-items-center gap-3">
                            <i class="bi bi-truck fs-2 text-primary"></i>
                            <div>
                                <span class="d-block fw-semibold">Estimated Delivery</span>
                                <small class="text-muted">
                                    <%= new Date(Date.now() + 7*24*60*60*1000).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }) %>
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkout Button -->
                    <div class="d-flex justify-content-between align-items-center gap-3">
                        <a href="/web" class="btn btn-outline-primary btn-lg continue-shopping">
                            <i class="bi bi-arrow-left me-2"></i>
                            Continue Shopping
                        </a>
                        
                        <a href="/web/checkout" class="btn btn-success btn-lg checkout-btn flex-grow-1">
                            <i class="bi bi-lock me-2"></i>
                            Proceed to Checkout
                            <i class="bi bi-arrow-right ms-2"></i>
                        </a>
                    </div>
                    
                    <!-- Secure Payment Badge -->
                    <div class="secure-payment text-center mt-4">
                        <div class="d-flex justify-content-center gap-4">
                            <span class="text-muted small">
                                <i class="bi bi-shield-check text-success me-1"></i>Secure Payment
                            </span>
                            <span class="text-muted small">
                                <i class="bi bi-arrow-repeat text-info me-1"></i>Easy Returns
                            </span>
                            <span class="text-muted small">
                                <i class="bi bi-truck text-primary me-1"></i>Free Shipping
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    <% } %>

</div>

<style>
    /* Custom CSS without JavaScript */
    
    /* Header Styling */
    .cart-header {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #333 0%, #667eea 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: fadeInDown 0.8s ease;
    }
    
    .header-underline {
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 2px;
        animation: underlineWidth 2s infinite;
    }
    
    @keyframes underlineWidth {
        0%, 100% { width: 100px; }
        50% { width: 150px; }
    }
    
    /* Empty Cart Styling */
    .empty-cart-container {
        animation: fadeInUp 0.8s ease;
        border: 2px dashed #dee2e6;
    }
    
    .empty-cart-icon {
        animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-15px); }
    }
    
    .suggested-item {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .suggested-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        background: linear-gradient(135deg, #667eea, #764ba2) !important;
        color: white;
    }
    
    /* Cart Item Styling */
    .cart-item {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
        position: relative;
        overflow: hidden;
    }
    
    .cart-item:hover {
        transform: translateX(5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1) !important;
        border-left-color: #667eea;
    }
    
    .cart-item-image-wrapper {
        padding: 10px;
        background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .cart-item:hover .cart-item-image-wrapper {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .cart-item-image {
        transition: transform 0.5s ease;
    }
    
    .cart-item:hover .cart-item-image {
        transform: rotate(5deg) scale(1.1);
    }
    
    /* Product Name */
    .product-name {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Quantity Controls */
    .quantity-btn {
        transition: all 0.3s ease;
        border-width: 2px;
        font-weight: bold;
    }
    
    .decrement-btn:hover {
        background: #dc3545;
        color: white;
        transform: rotate(360deg);
    }
    
    .increment-btn:hover {
        background: #28a745;
        color: white;
        transform: rotate(360deg);
    }
    
    .quantity-display {
        min-width: 40px;
        text-align: center;
        font-size: 1.2rem;
        color: #2c3e50;
        background: #f8f9fa;
        padding: 5px 0;
        border-radius: 20px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    /* Remove Button */
    .remove-btn {
        transition: all 0.3s ease;
        border-width: 2px;
        padding: 8px 20px;
        border-radius: 25px;
    }
    
    .remove-btn:hover {
        background: #dc3545;
        color: white;
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
    }
    
    /* Summary Card */
    .summary-card {
        animation: slideUp 0.8s ease;
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    }
    
    .summary-title {
        color: #2c3e50;
        position: relative;
        display: inline-block;
    }
    
    .summary-title::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 50px;
        height: 3px;
        background: linear-gradient(135deg, #28a745, #20c997);
        border-radius: 2px;
        animation: titleLine 2s infinite;
    }
    
    @keyframes titleLine {
        0%, 100% { width: 50px; }
        50% { width: 100px; }
    }
    
    /* Total Amount */
    .total-amount {
        position: relative;
        animation: amountPop 1s ease;
    }
    
    @keyframes amountPop {
        0% { transform: scale(0.8); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }
    
    /* Checkout Button */
    .checkout-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        border: none;
        padding: 15px;
        font-size: 1.2rem;
        border-radius: 12px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .checkout-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s ease;
    }
    
    .checkout-btn:hover::before {
        left: 100%;
    }
    
    .checkout-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
    }
    
    /* Continue Shopping Button */
    .continue-shopping {
        transition: all 0.3s ease;
        border-width: 2px;
        padding: 15px 25px;
        border-radius: 12px;
    }
    
    .continue-shopping:hover {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-color: transparent;
        transform: translateX(-5px);
    }
    
    /* Delivery Estimate */
    .delivery-estimate {
        animation: slideInRight 0.8s ease;
        border-left: 4px solid #667eea;
    }
    
    .delivery-estimate i {
        animation: truckMove 2s infinite;
    }
    
    @keyframes truckMove {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(5px); }
    }
    
    /* Item Progress Bar */
    .item-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        transition: width 0.3s ease;
    }
    
    /* Animations */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .cart-header {
            font-size: 2rem;
        }
        
        .cart-item .row > div {
            text-align: center !important;
        }
        
        .cart-item .col-md-3.text-end {
            text-align: center !important;
        }
        
        .quantity-controls {
            justify-content: center !important;
        }
        
        .summary-card .d-flex {
            flex-direction: column;
            gap: 15px;
        }
        
        .checkout-btn, .continue-shopping {
            width: 100%;
        }
        
        .cart-item-image-wrapper {
            max-width: 150px;
            margin: 0 auto;
        }
    }
    
    /* Custom Scrollbar */
    .cart-items-container {
        max-height: 600px;
        overflow-y: auto;
        padding-right: 10px;
    }
    
    .cart-items-container::-webkit-scrollbar {
        width: 6px;
    }
    
    .cart-items-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .cart-items-container::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 10px;
    }
    
    .cart-items-container::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #764ba2, #667eea);
    }
    
    /* Loading States */
    .cart-item {
        animation: cardPulse 2s infinite;
    }
    
    @keyframes cardPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.98; }
    }
    
    /* Bootstrap Icons */
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css");
</style>

</body>
</html>