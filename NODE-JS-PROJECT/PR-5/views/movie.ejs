<!DOCTYPE html>
<html>
<head>
    <title>Movie App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #008080;
            --secondary-color: #808080;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #666;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 10px;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--dark-text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-custom {
            background-color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: white !important;
        }
        
        .tagline {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        .container {
            max-width: 1200px;
        }
        
        .search-container {
            background-color: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
            margin-bottom: 30px;
            border-left: 5px solid var(--primary-color);
        }
        
        .movie-form {
            background-color: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border-top: 5px solid var(--secondary-color);
        }
        
        .movie-form h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-bg);
        }
        
        .movie-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
            border-top: 4px solid var(--primary-color);
        }
        
        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .movie-poster {
            width: 100%;
            height: 280px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        
        .movie-info {
            padding: 20px;
        }
        
        .movie-title {
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: 8px;
            font-size: 1.2rem;
            height: 2.8rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .movie-genre {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .movie-rating {
            color: #ffc107;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .movie-year {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .movie-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .btn-custom {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            background-color: #006666;
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-outline-custom {
            background-color: transparent;
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-outline-custom:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .page-link {
            color: var(--primary-color);
            border: 1px solid #dee2e6;
        }
        
        .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 128, 128, 0.25);
        }
        
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
            text-align: center;
        }
        
        .stats {
            background-color: white;
            padding: 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item {
            padding: 10px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .sort-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sort-label {
            color: var(--secondary-color);
            font-weight: 600;
            white-space: nowrap;
        }
        
        @media (max-width: 768px) {
            .movie-poster {
                height: 200px;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
        <a class="navbar-brand" href="/">KP MovieHub
        </a>
    </div>
</nav>

<div class="container mt-4">
    
    <!-- Search and Sort Section -->
    <div class="search-container">
        <h3 class="mb-3" style="color: var(--primary-color);">
            <i class="fas fa-search me-2"></i>Find Your Movie
        </h3>
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-6">
                <label for="search" class="form-label">Search by title or genre</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="search" name="search" value="<%= search %>" placeholder="Enter movie title, genre, or keyword">
                </div>
            </div>
            <div class="col-md-4">
                <div class="sort-container">
                    <span class="sort-label">Sort by:</span>
                    <select name="sort" class="form-select">
                        <option value="">Default</option>
                        <option value="rating_asc" <%= sort==='rating_asc'?'selected':'' %>>Rating (Low to High)</option>
                        <option value="rating_desc" <%= sort==='rating_desc'?'selected':'' %>>Rating (High to Low)</option>
                        <option value="year_asc" <%= sort==='year_asc'?'selected':'' %>>Year (Oldest First)</option>
                        <option value="year_desc" <%= sort==='year_desc'?'selected':'' %>>Year (Newest First)</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-custom w-100">
                    <i class="fas fa-filter me-1"></i> Apply
                </button>
            </div>
        </form>
    </div>
    
    <!-- Stats Section -->
    <div class="stats">
        <div class="stat-item">
            <div class="stat-value"><%= allMovies.length %></div>
            <div class="stat-label">Movies</div>
        </div>
        <div class="stat-item">
            <%
                let avgRating = 0;
                if (allMovies.length > 0) {
                    const totalRating = allMovies.reduce((sum, movie) => sum + parseFloat(movie.rating || 0), 0);
                    avgRating = (totalRating / allMovies.length).toFixed(1);
                }
            %>
            <div class="stat-value"><%= avgRating %></div>
            <div class="stat-label">Avg Rating</div>
        </div>
        <div class="stat-item">
            <%
                let genres = [];
                allMovies.forEach(movie => {
                    if (movie.genre && !genres.includes(movie.genre)) {
                        genres.push(movie.genre);
                    }
                });
            %>
            <div class="stat-value"><%= genres.length %></div>
            <div class="stat-label">Genres</div>
        </div>
        <div class="stat-item">
            <%
                let currentYear = new Date().getFullYear();
                let recentMovies = allMovies.filter(movie => {
                    return movie.releaseYear && parseInt(movie.releaseYear) >= currentYear - 5;
                });
            %>
            <div class="stat-value"><%= recentMovies.length %></div>
            <div class="stat-label">Recent (5 yrs)</div>
        </div>
    </div>
    
    <!-- Add Movie Form -->
    <div class="movie-form">
        <h3><i class="fas fa-plus-circle me-2"></i>Add New Movie</h3>
        <form action="/add" method="POST" enctype="multipart/form-data" class="row g-3">
            <div class="col-md-4">
                <label for="title" class="form-label">Movie Title <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="title" name="title" placeholder="Enter movie title" required>
            </div>
            <div class="col-md-3">
                <label for="genre" class="form-label">Genre</label>
                <input type="text" class="form-control" id="genre" name="genre" placeholder="e.g., Action, Drama">
            </div>
            <div class="col-md-2">
                <label for="rating" class="form-label">Rating (0-10)</label>
                <input type="number" class="form-control" id="rating" name="rating" min="0" max="10" step="0.1" placeholder="8.5">
            </div>
            <div class="col-md-2">
                <label for="releaseYear" class="form-label">Release Year</label>
                <input type="number" class="form-control" id="releaseYear" name="releaseYear" placeholder="2023">
            </div>
            <div class="col-md-4">
                <label for="poster" class="form-label">Poster Image</label>
                <input type="file" class="form-control" id="poster" name="poster" accept="image/*">
                <div class="form-text">Upload a movie poster image</div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-custom">
                    <i class="fas fa-save me-1"></i> Add Movie
                </button>
            </div>
        </form>
    </div>
    
    <!-- Movie Grid -->
    <h3 class="mb-3" style="color: var(--primary-color);">
        <i class="fas fa-th-large me-2"></i>Movie Collection
    </h3>
    
    <% if (allMovies.length === 0) { %>
        <div class="text-center py-5">
            <i class="fas fa-film fa-4x mb-3" style="color: var(--secondary-color);"></i>
            <h4 style="color: var(--secondary-color);">No movies found</h4>
            <p class="text-muted">Try adding a movie or adjusting your search criteria.</p>
        </div>
    <% } else { %>
        <div class="row">
            <% allMovies.forEach(movie => { %>
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <div class="movie-card">
                        <img src="<%= movie.poster || 'https://via.placeholder.com/300x450/008080/FFFFFF?text=No+Poster' %>" class="movie-poster" alt="<%= movie.title %> poster">
                        <div class="movie-info">
                            <h5 class="movie-title"><%= movie.title %></h5>
                            <div class="movie-genre">
                                <i class="fas fa-tag me-1"></i><%= movie.genre || 'Not specified' %>
                            </div>
                            <div class="movie-rating">
                                <i class="fas fa-star me-1"></i><%= movie.rating || 'N/A' %>/10
                            </div>
                            <div class="movie-year">
                                <i class="fas fa-calendar-alt me-1"></i><%= movie.releaseYear || 'Unknown' %>
                            </div>
                            <div class="movie-actions">
                                <a href="/edit/<%= movie._id %>" class="btn btn-outline-custom btn-sm">
                                    <i class="fas fa-edit me-1"></i> Edit
                                </a>
                                <a href="/delete/<%= movie._id %>" class="btn btn-custom btn-sm">
                                    <i class="fas fa-trash me-1"></i> Delete
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } %>
    
    <!-- Pagination -->
    <% if (totalPages > 1) { %>
        <nav class="mt-5">
            <ul class="pagination justify-content-center">
                <% for(let i=1;i<=totalPages;i++){ %>
                    <li class="page-item <%= currentPage===i?'active':'' %>">
                        <a class="page-link" href="/?page=<%=i%>&search=<%=search%>&sort=<%=sort%>"><%=i%></a>
                    </li>
                <% } %>
            </ul>
        </nav>
    <% } %>
    
</div>
</body>
</html>